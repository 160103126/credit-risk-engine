FROM ghcr.io/mlflow/mlflow:v2.9.2

# Install PostgreSQL adapter and boto3 for S3
RUN pip install --no-cache-dir psycopg2-binary boto3

# Expose port
EXPOSE 5000

# Override entrypoint to ensure 0.0.0.0 binding
ENTRYPOINT []
CMD ["sh", "-c", "mlflow server --backend-store-uri ${MLFLOW_BACKEND_STORE_URI} --default-artifact-root ${MLFLOW_DEFAULT_ARTIFACT_ROOT} --host 0.0.0.0 --port 5000"]
